<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Tensorflow Mnist手写数字识别Go实战 | STep by STep</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Tensflow安装好以后，当然要上手折腾一下啦。其实Tensorflow的入门教程很多地方都有，官方的Tutorials也写的很好。所以在这里记录一下本人折腾的过程，做一些补充。
基础知识首先学习Tensorflow的基本使用和关于神经网络的知识，这里推荐的教程有：

Tensorflow官方教程
没有博士学位，照样玩转TensorFlow深度学习

本文所用代码放在了github上，如果想编译">
<meta property="og:type" content="article">
<meta property="og:title" content="Tensorflow Mnist手写数字识别Go实战">
<meta property="og:url" content="http://sineyuan.github.io/2017/03/02/tensorflow-mnist-pratice/index.html">
<meta property="og:site_name" content="STep by STep">
<meta property="og:description" content="Tensflow安装好以后，当然要上手折腾一下啦。其实Tensorflow的入门教程很多地方都有，官方的Tutorials也写的很好。所以在这里记录一下本人折腾的过程，做一些补充。
基础知识首先学习Tensorflow的基本使用和关于神经网络的知识，这里推荐的教程有：

Tensorflow官方教程
没有博士学位，照样玩转TensorFlow深度学习

本文所用代码放在了github上，如果想编译">
<meta property="og:image" content="https://github.com/SineYuan/tensorflow-demo/blob/master/doc/images/mnist_web.png?raw=true">
<meta property="og:updated_time" content="2017-03-02T07:36:15.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Tensorflow Mnist手写数字识别Go实战">
<meta name="twitter:description" content="Tensflow安装好以后，当然要上手折腾一下啦。其实Tensorflow的入门教程很多地方都有，官方的Tutorials也写的很好。所以在这里记录一下本人折腾的过程，做一些补充。
基础知识首先学习Tensorflow的基本使用和关于神经网络的知识，这里推荐的教程有：

Tensorflow官方教程
没有博士学位，照样玩转TensorFlow深度学习

本文所用代码放在了github上，如果想编译">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,600' rel='stylesheet' type='text/css'>
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro:400,700" rel="stylesheet" type="text/css">
  <!-- <link href="//fonts.useso.com/css?family=Source+Code+Pro:400,700" rel="stylesheet" type="text/css"> -->
  <!-- <link href='//fonts.useso.com/css?family=Open+Sans:300,600' rel='stylesheet' type='text/css'> -->
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="header-outer" class="outer">
    <a href="/" class="logo">STep by STep</a>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/about/index.html">About</a>
        
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://sineyuan.github.io"></form>
        </div>
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
        
        
          <a id="nav-github-link" class="nav-icon" href="https://github.com/SineYuan" title="Fork me on GitHub"></a>
        
      </nav>
    </div>
  </div>
</header>
      <nav id="mobile-nav" class="off">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/about/index.html" class="mobile-nav-link">About</a>
  
  <div id="search-form-wrap-mobile">
    <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://sineyuan.github.io"></form>
  </div>
</nav>
      <div class="outer">
        
          <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">March 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/02/">February 2015</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/12/29/clickhouse-docker-quick-start/">用Docker快速上手Clickhouse</a>
          </li>
        
          <li>
            <a href="/2017/03/16/mxnet-begin/">MXNet上手</a>
          </li>
        
          <li>
            <a href="/2017/03/02/tensorflow-mnist-pratice/">Tensorflow Mnist手写数字识别Go实战</a>
          </li>
        
          <li>
            <a href="/2017/02/19/tensorflow-windows-installation/">在Windows上安装Tensorflow</a>
          </li>
        
          <li>
            <a href="/2017/01/27/go-naming/">(译)Go naming conventions</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">links</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="http://hexo.io">Hexo</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
        <section id="main"><article id="post-tensorflow-mnist-pratice" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/02/tensorflow-mnist-pratice/" class="article-date">
  <time datetime="2017-03-01T16:00:00.000Z" itemprop="datePublished">2017-03-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Tensorflow Mnist手写数字识别Go实战
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Tensflow安装好以后，当然要上手折腾一下啦。其实Tensorflow的入门教程很多地方都有，官方的Tutorials也写的很好。所以在这里记录一下本人折腾的过程，做一些补充。</p>
<h2 id="基础知识">基础知识</h2><p>首先学习Tensorflow的基本使用和关于神经网络的知识，这里推荐的教程有：</p>
<ul>
<li><a href="https://www.tensorflow.org/get_started/mnist/beginners" target="_blank" rel="external">Tensorflow官方教程</a></li>
<li><a href="http://mp.weixin.qq.com/s/E6SsvWofiN94JtZWf1f-Ug" target="_blank" rel="external">没有博士学位，照样玩转TensorFlow深度学习</a></li>
</ul>
<p>本文所用代码放在了<a href="https://github.com/SineYuan/tensorflow-demo" target="_blank" rel="external">github</a>上，如果想编译运行请将项目clone到<code>$GOPATH/src</code>下</p>
<h2 id="训练模型">训练模型</h2><p>我们先训练一个最简单的识别模型，代码码改自<a href="https://github.com/martin-gorner/tensorflow-mnist-tutorial" target="_blank" rel="external">https://github.com/martin-gorner/tensorflow-mnist-tutorial</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mnist_softmax.py</span></span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">from</span> tensorflow.examples.tutorials.mnist <span class="keyword">import</span> input_data</span><br><span class="line"><span class="keyword">from</span> tensorflow.contrib.session_bundle <span class="keyword">import</span> exporter</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(flags)</span>:</span></span><br><span class="line">    mnist = input_data.read_data_sets(flags.mnist_data_dir, reshape=<span class="keyword">False</span>, one_hot=<span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># neural network with 1 layer of 10 softmax neurons</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># · · · · · · · · · ·       (input data, flattened pixels)       X [batch, 784]        # 784 = 28 * 28</span></span><br><span class="line">    <span class="comment"># \x/x\x/x\x/x\x/x\x/    -- fully connected layer (softmax)      W [784, 10]     b[10]</span></span><br><span class="line">    <span class="comment">#   · · · · · · · ·                                              Y [batch, 10]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># The model is:</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># Y = softmax( X * W + b)</span></span><br><span class="line">    <span class="comment">#              X: matrix for 100 grayscale images of 28x28 pixels, flattened (there are 100 images in a mini-batch)</span></span><br><span class="line">    <span class="comment">#              W: weight matrix with 784 lines and 10 columns</span></span><br><span class="line">    <span class="comment">#              b: bias vector with 10 dimensions</span></span><br><span class="line">    <span class="comment">#              +: add with broadcasting: adds the vector to each line of the matrix (numpy)</span></span><br><span class="line">    <span class="comment">#              softmax(matrix) applies softmax on each line</span></span><br><span class="line">    <span class="comment">#              softmax(line) applies an exp to each value then divides by the norm of the resulting line</span></span><br><span class="line">    <span class="comment">#              Y: output matrix with 100 lines and 10 columns</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># input X: 28x28 grayscale images, the first dimension (None) will index the images in the mini-batch</span></span><br><span class="line">    X = tf.placeholder(tf.float32, [<span class="keyword">None</span>, <span class="number">28</span>, <span class="number">28</span>, <span class="number">1</span>])</span><br><span class="line">    <span class="comment"># correct answers will go here</span></span><br><span class="line">    Y_ = tf.placeholder(tf.float32, [<span class="keyword">None</span>, <span class="number">10</span>])</span><br><span class="line">    <span class="comment"># weights W[784, 10]   784=28*28</span></span><br><span class="line">    W = tf.Variable(tf.zeros([<span class="number">784</span>, <span class="number">10</span>]))</span><br><span class="line">    <span class="comment"># biases b[10]</span></span><br><span class="line">    b = tf.Variable(tf.zeros([<span class="number">10</span>]))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># flatten the images into a single line of pixels</span></span><br><span class="line">    <span class="comment"># -1 in the shape definition means "the only possible dimension that will preserve the number of elements"</span></span><br><span class="line">    XX = tf.reshape(X, [-<span class="number">1</span>, <span class="number">784</span>])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># The model</span></span><br><span class="line">    Y = tf.nn.softmax(tf.matmul(XX, W) + b)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># loss function: cross-entropy = - sum( Y_i * log(Yi) )</span></span><br><span class="line">    <span class="comment">#                           Y: the computed output vector</span></span><br><span class="line">    <span class="comment">#                           Y_: the desired output vector</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># cross-entropy</span></span><br><span class="line">    <span class="comment"># log takes the log of each element, * multiplies the tensors element by element</span></span><br><span class="line">    <span class="comment"># reduce_mean will add all the components in the tensor</span></span><br><span class="line">    <span class="comment"># so here we end up with the total cross-entropy for all images in the batch</span></span><br><span class="line">    cross_entropy = -tf.reduce_mean(Y_ * tf.log(Y)) * <span class="number">1000.0</span>  <span class="comment"># normalized for batches of 100 images,</span></span><br><span class="line">    <span class="comment"># *10 because  "mean" included an unwanted division by 10</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># accuracy of the trained model, between 0 (worst) and 1 (best)</span></span><br><span class="line">    correct_prediction = tf.equal(tf.argmax(Y, <span class="number">1</span>), tf.argmax(Y_, <span class="number">1</span>))</span><br><span class="line">    accuracy = tf.reduce_mean(tf.cast(correct_prediction, tf.float32))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># training, learning rate = 0.005</span></span><br><span class="line">    train_step = tf.train.GradientDescentOptimizer(<span class="number">0.005</span>).minimize(cross_entropy)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># init</span></span><br><span class="line">    init = tf.global_variables_initializer()</span><br><span class="line">    sess = tf.Session()</span><br><span class="line">    sess.run(init)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(flags.iterations):</span><br><span class="line">        batch_X, batch_Y = mnist.train.next_batch(flags.batch_size)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># the backpropagation training step</span></span><br><span class="line">        sess.run(train_step, feed_dict=&#123;X: batch_X, Y_: batch_Y&#125;)</span><br><span class="line"></span><br><span class="line">        print(<span class="string">"Iteration:"</span> + str(i) + <span class="string">"/"</span> + str(flags.iterations))</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"******* Training is Done! *******"</span>)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"Accuracy:"</span>, sess.run(accuracy, feed_dict=&#123;X: mnist.test.images, Y_: mnist.test.labels&#125;))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Export model to Tensorflow Serving</span></span><br><span class="line">    saver = tf.train.Saver()</span><br><span class="line"></span><br><span class="line">    model_exporter = exporter.Exporter(saver)</span><br><span class="line">    model_exporter.init(</span><br><span class="line">        sess.graph.as_graph_def(),</span><br><span class="line">        named_graph_signatures=&#123;</span><br><span class="line">            <span class="string">'inputs'</span>: exporter.generic_signature(&#123;<span class="string">'x'</span>: X&#125;),</span><br><span class="line">            <span class="string">'outputs'</span>: exporter.generic_signature(&#123;<span class="string">'y'</span>: Y&#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">    model_exporter.export(flags.model_dir, tf.constant(flags.model_version), sess)</span><br><span class="line">    print(<span class="string">"Model Saved at"</span>, str(flags.model_dir), <span class="string">"version:"</span>, flags.model_version)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    parser = argparse.ArgumentParser()</span><br><span class="line">    parser.add_argument(</span><br><span class="line">        <span class="string">'--learning_rate'</span>,</span><br><span class="line">        type=float,</span><br><span class="line">        default=<span class="number">0.05</span>,</span><br><span class="line">        help=<span class="string">'Initial learning rate.'</span></span><br><span class="line">    )</span><br><span class="line">    parser.add_argument(</span><br><span class="line">        <span class="string">'--iterations'</span>,</span><br><span class="line">        type=int,</span><br><span class="line">        default=<span class="number">2000</span>,</span><br><span class="line">        help=<span class="string">'Number of iterations to run trainer.'</span></span><br><span class="line">    )</span><br><span class="line">    parser.add_argument(</span><br><span class="line">        <span class="string">'--batch_size'</span>,</span><br><span class="line">        type=int,</span><br><span class="line">        default=<span class="number">100</span>,</span><br><span class="line">        help=<span class="string">'Batch size.  Must divide evenly into the dataset sizes.'</span></span><br><span class="line">    )</span><br><span class="line">    parser.add_argument(</span><br><span class="line">        <span class="string">'--mnist_data_dir'</span>,</span><br><span class="line">        type=str,</span><br><span class="line">        default=<span class="string">'./MNIST_data'</span>,</span><br><span class="line">        help=<span class="string">'Directory to put the mnist data.'</span></span><br><span class="line">    )</span><br><span class="line">    parser.add_argument(</span><br><span class="line">        <span class="string">'--model_dir'</span>,</span><br><span class="line">        type=str,</span><br><span class="line">        default=<span class="string">'./model'</span>,</span><br><span class="line">        help=<span class="string">'Directory to export model.'</span></span><br><span class="line">    )</span><br><span class="line">    parser.add_argument(</span><br><span class="line">        <span class="string">'--model_version'</span>,</span><br><span class="line">        type=int,</span><br><span class="line">        default=<span class="number">1</span>,</span><br><span class="line">        help=<span class="string">'Model version'</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    FLAGS, unparsed = parser.parse_known_args()</span><br><span class="line"></span><br><span class="line">    main(FLAGS)</span><br></pre></td></tr></table></figure>
<p>运行<code>mnist_softmax.py</code>, 第一次运行会在默认路径下载mnist数据。<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">python</span> mnist_softmax.<span class="keyword">py</span></span><br></pre></td></tr></table></figure></p>
<p>softmax模型正确率在92%的左右。训练的模型默认保存在<code>./model</code>目录下。 可以在<code>./model/</code>下看的多了个<code>00000001</code>的文件夹，里面存放的是版本号为1的模型数据。</p>
<h2 id="Tensorflow_Serving">Tensorflow Serving</h2><p>有了模型之后我们还要将其做成产品，Tensorflow提供了Tensorflow Serving，可以将训练的模型直接做成一个rpc服务，外部可以通过调用rpc来获取模型输出的结果。<br>下面我们做一个MNIST手写数字识别的web应用来实践一下。</p>
<p>项目代码在放在<a href="">github</a>上，前端用jquery + <a href="http://leimi.github.io/drawingboard.js/" target="_blank" rel="external">drawingboard.js</a>, 后端用Go做API Server, 通过grpc调用Tensorflow Sering获取识别结果。</p>
<h3 id="编译Tensorflow_Model_Server">编译Tensorflow Model Server</h3><p>具体参照<a href="https://tensorflow.github.io/serving/setup" target="_blank" rel="external">Tensorflow Serving官方文档</a>, 目前版本的Tensorflow Serving在OSX上编译有问题，不过还好官方提供了编译环境的Dockerfile， 跟着走一遍<a href="https://tensorflow.github.io/serving/docker" target="_blank" rel="external">教程</a>就好。</p>
<p>配置好环境以后我们编译tensorflow_model_server。</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="label">cd</span> serving</span><br><span class="line"><span class="keyword">bazel </span><span class="keyword">build </span>//tensorflow_serving/model_servers:tensorflow_model_server</span><br></pre></td></tr></table></figure>
<p>如果不想编译那么麻烦的话，可以用我做的tensorflow_model_server的docker镜像, 当前对应的tensorflow serving的版本是v0.5.1</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker pull sineyuan/tensorflow_model_server</span><br><span class="line">cd tensorflow-demo</span><br><span class="line">docker run  -v <span class="variable">$PWD</span>:/work -p <span class="number">8500</span>:<span class="number">8500</span>  sineyuan/tensorflow_model_server --model_base_path=/work/mnist/model</span><br></pre></td></tr></table></figure>
<h3 id="运行Tensorflow_Model_Server">运行Tensorflow Model Server</h3><p>运行<code>tensorflow_model_server</code>, 指定训练模型的路径：</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bazel-bin<span class="regexp">/tensorflow_serving/m</span>odel_servers<span class="regexp">/tensorflow_model_server --model_base_path=$&#123;path_to_tensorflow_demo_root&#125;/m</span>odel</span><br></pre></td></tr></table></figure>
<p><code>tensorflow_model_server</code>默认监听8500端口。</p>
<h3 id="生成Tensorflow_Serving的Go客户端包">生成Tensorflow Serving的Go客户端包</h3><p>tensorflow_model_server使用的是google自家的grpc框架, 官方例子的客户端是基于python的，没有提供Go客户端包。不过grpc是跨语言的，我们需要通过tensorflow serving提供的protobuf文件自己编译。</p>
<p>先安装grpc, 看官方的安装文档<a href="http://www.grpc.io/docs/quickstart/go.html" target="_blank" rel="external">http://www.grpc.io/docs/quickstart/go.html</a>。</p>
<p>下载Tensorflow Serving源码。</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git <span class="keyword">clone</span> <span class="title">--recurse-submodules</span> https://github.com/tensorflow/serving</span><br><span class="line">cd serving</span><br></pre></td></tr></table></figure>
<p>准备编译脚本<code>gen_proto.sh</code>：</p>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line">output=$&#123;<span class="number">1</span>:-vendor&#125;</span><br><span class="line"></span><br><span class="line">echo <span class="variable">$output</span></span><br><span class="line"></span><br><span class="line">mkdir -p <span class="variable">$output</span></span><br><span class="line"></span><br><span class="line">mkdir -p protobuf/src/google/protobuf</span><br><span class="line">cp <span class="variable">$GOPATH</span>/src/github.com/golang/protobuf/ptypes/<span class="literal">any</span>/<span class="literal">any</span>.<span class="keyword">proto</span> protobuf/src/google/protobuf/<span class="literal">any</span>.<span class="keyword">proto</span></span><br><span class="line">cp <span class="variable">$GOPATH</span>/src/github.com/golang/protobuf/ptypes/wrappers/wrappers.<span class="keyword">proto</span> protobuf/src/google/protobuf/wrappers.<span class="keyword">proto</span></span><br><span class="line"></span><br><span class="line">protoc -I=. -I=./tensorflow -I=./protobuf/src --go_out=plugins=grpc:<span class="variable">$output</span> ./tensorflow_serving/apis/*.<span class="keyword">proto</span></span><br><span class="line"></span><br><span class="line">protoc -I=./tensorflow --go_out=plugins=grpc:<span class="variable">$output</span> tensorflow/tensorflow/core/example/*.<span class="keyword">proto</span></span><br><span class="line">protoc -I=./tensorflow --go_out=plugins=grpc:<span class="variable">$output</span> tensorflow/tensorflow/core/framework/*.<span class="keyword">proto</span></span><br><span class="line"></span><br><span class="line">protoc -I=./tensorflow -I=./protobuf/src --go_out=plugins=grpc:<span class="variable">$output</span> \</span><br><span class="line">	tensorflow/tensorflow/core/protobuf/saver.<span class="keyword">proto</span>  \</span><br><span class="line">	tensorflow/tensorflow/core/protobuf/meta_graph.<span class="keyword">proto</span></span><br><span class="line"></span><br><span class="line">rm -r protobuf</span><br></pre></td></tr></table></figure>
<p>将<code>gen_proto.sh</code>放在下载的Tensorflow Serving源码目录下， 在源码目录下执行：</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">sh</span> gen_proto.<span class="keyword">sh</span></span><br></pre></td></tr></table></figure>
<p>在源码目录下即可生成<code>vendor</code>文件夹，将<code>vendor</code>文件夹放到我们的Demo项目目录下即可。</p>
<h3 id="Go_API_Server">Go API Server</h3><p>用Go写一个简单的API Server展示Tensorflow Serving的调用方法, 为了省事，直接用了<a href="https://github.com/labstack/echo" target="_blank" rel="external">echo</a>这个web框架。</p>
<p>gprc调用Tensorflow Serving的具体方法参见下面代码</p>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"flag"</span></span><br><span class="line">	<span class="string">"context"</span></span><br><span class="line">	<span class="string">"strconv"</span></span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">	<span class="string">"io/ioutil"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"github.com/labstack/echo"</span></span><br><span class="line">	<span class="string">"google.golang.org/grpc"</span></span><br><span class="line"></span><br><span class="line">	tf_framework <span class="string">"tensorflow/core/framework"</span></span><br><span class="line">	pb <span class="string">"tensorflow_serving/apis"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	port         <span class="type">int</span></span><br><span class="line">	model_server <span class="type">string</span></span><br><span class="line">	model_name   <span class="type">string</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func init() &#123;</span><br><span class="line">	flag.<span class="type">IntVar</span>(&amp;port, <span class="string">"port"</span>, <span class="number">1323</span>, <span class="string">"concurrent processing ,default 1 ."</span>)</span><br><span class="line">	flag.<span class="type">StringVar</span>(&amp;model_server, <span class="string">"model_server"</span>, <span class="string">"localhost:8500"</span>, <span class="string">"concurrent processing ,default 1 ."</span>)</span><br><span class="line">	flag.<span class="type">StringVar</span>(&amp;model_name, <span class="string">"model_name"</span>, <span class="string">"default"</span>, <span class="string">"concurrent processing ,default 1 ."</span>)</span><br><span class="line"></span><br><span class="line">	flag.<span class="type">Parse</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="type">Resp</span> struct &#123;</span><br><span class="line">	<span class="type">Success</span> <span class="type">bool</span></span><br><span class="line">	<span class="type">Msg</span>     <span class="type">string</span></span><br><span class="line">	<span class="type">Result</span>  [<span class="number">10</span>]<span class="type">float32</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	e := echo.<span class="type">New</span>()</span><br><span class="line">	// <span class="type">Set</span> up a connection to the model server.</span><br><span class="line">	conn, err := grpc.<span class="type">Dial</span>(model_server, grpc.<span class="type">WithInsecure</span>())</span><br><span class="line">	<span class="keyword">if</span> err != <span class="keyword">nil</span> &#123;</span><br><span class="line">		e.<span class="type">Logger</span>.<span class="type">Fatalf</span>(<span class="string">"can not connect model_server: %v"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	defer conn.<span class="type">Close</span>()</span><br><span class="line"></span><br><span class="line">	client := pb.<span class="type">NewPredictionServiceClient</span>(conn)</span><br><span class="line"></span><br><span class="line">	e.<span class="type">Static</span>(<span class="string">"/"</span>, <span class="string">"templates"</span>)</span><br><span class="line">	e.<span class="type">Static</span>(<span class="string">"/static"</span>, <span class="string">"static"</span>)</span><br><span class="line"></span><br><span class="line">	e.<span class="type">POST</span>(<span class="string">"/api/mnist"</span>, func(c echo.<span class="type">Context</span>) error &#123;</span><br><span class="line">		req := c.<span class="type">Request</span>()</span><br><span class="line">		body, err := ioutil.<span class="type">ReadAll</span>(req.<span class="type">Body</span>)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="keyword">nil</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> err</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="literal">result</span>, err := <span class="type">Predict</span>(client, body)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="keyword">nil</span> &#123;</span><br><span class="line">			e.<span class="type">Logger</span>.<span class="type">Error</span>(err.<span class="type">Error</span>())</span><br><span class="line">			<span class="keyword">return</span> c.<span class="type">JSON</span>(http.<span class="type">StatusOK</span>, &amp;<span class="type">Resp</span>&#123;</span><br><span class="line">				<span class="type">Msg</span>: err.<span class="type">Error</span>(),</span><br><span class="line">			&#125;)</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> c.<span class="type">JSON</span>(http.<span class="type">StatusOK</span>, &amp;<span class="type">Resp</span>&#123;</span><br><span class="line">			<span class="type">Success</span>: <span class="literal">true</span>,</span><br><span class="line">			<span class="type">Result</span>:  <span class="literal">result</span>,</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	e.<span class="type">Logger</span>.<span class="type">Fatal</span>(e.<span class="type">Start</span>(<span class="string">":"</span> + strconv.<span class="type">Itoa</span>(port)))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func <span class="type">Predict</span>(c pb.<span class="type">PredictionServiceClient</span>, imgBytes []byte) (<span class="literal">result</span> [<span class="number">10</span>]<span class="type">float32</span>, err error) &#123;</span><br><span class="line">	// 构造请求</span><br><span class="line">	req := &amp;pb.<span class="type">PredictRequest</span>&#123;</span><br><span class="line">		// model名由tensorflow_model_server的启动参数 --model_name 指定, 默认是default</span><br><span class="line">		<span class="type">ModelSpec</span>: &amp;pb.<span class="type">ModelSpec</span>&#123;<span class="type">Name</span>: model_name&#125;,</span><br><span class="line">		<span class="type">Inputs</span>:    make(map[<span class="type">string</span>]*tf_framework.<span class="type">TensorProto</span>),</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">in</span> := normalize(imgBytes)</span><br><span class="line"></span><br><span class="line">	// 输入数据</span><br><span class="line">	tp := &amp;tf_framework.<span class="type">TensorProto</span>&#123;</span><br><span class="line">		<span class="type">Dtype</span>:    tf_framework.<span class="type">DataType_DT_FLOAT</span>,</span><br><span class="line">		<span class="type">FloatVal</span>: <span class="keyword">in</span>,</span><br><span class="line">		// 由于输入只能是一个slice，所以要在这里声明输入数据的shape</span><br><span class="line">		// <span class="type">Tensorflow</span> <span class="type">Model</span> <span class="type">Server</span>将数据resize成输入<span class="type">Tensor</span>需要的shape</span><br><span class="line">		<span class="type">TensorShape</span>: &amp;tf_framework.<span class="type">TensorShapeProto</span>&#123;</span><br><span class="line">			<span class="type">Dim</span>: []*tf_framework.<span class="type">TensorShapeProto_Dim</span>&#123;</span><br><span class="line">				&amp;tf_framework.<span class="type">TensorShapeProto_Dim</span>&#123;</span><br><span class="line">					<span class="type">Size</span>: <span class="type">int64</span>(<span class="number">1</span>),</span><br><span class="line">					<span class="type">Name</span>: <span class="string">"batch"</span>,</span><br><span class="line">				&#125;,</span><br><span class="line">				&amp;tf_framework.<span class="type">TensorShapeProto_Dim</span>&#123;</span><br><span class="line">					<span class="type">Size</span>: <span class="type">int64</span>(<span class="number">784</span>),</span><br><span class="line">					<span class="type">Name</span>: <span class="string">"data"</span>,</span><br><span class="line">				&#125;,</span><br><span class="line">			&#125;,</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;</span><br><span class="line">	// 输入参数名要与模型导出时指定的一致</span><br><span class="line">	req.<span class="type">Inputs</span>[<span class="string">"x"</span>] = tp</span><br><span class="line"></span><br><span class="line">	// 请求<span class="type">Model</span> <span class="type">Server</span></span><br><span class="line">	resp, err := c.<span class="type">Predict</span>(context.<span class="type">Background</span>(), req)</span><br><span class="line"></span><br><span class="line">	// 输出参数名要与模型导出时指定的一致</span><br><span class="line">	output, ok := resp.<span class="type">Outputs</span>[<span class="string">"y"</span>]</span><br><span class="line">	<span class="keyword">if</span> !ok &#123;</span><br><span class="line">		err = fmt.<span class="type">Errorf</span>(<span class="string">"can not find output data with label y"</span>)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> len(output.<span class="type">FloatVal</span>) != <span class="number">10</span> &#123;</span><br><span class="line">		err = fmt.<span class="type">Errorf</span>(<span class="string">"wrong output dimension, it should be 10, now got %d"</span>, len(output.<span class="type">FloatVal</span>))</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	copy(<span class="literal">result</span>[:], output.<span class="type">FloatVal</span>)</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func normalize(bytes []byte) (r []<span class="type">float32</span>) &#123;</span><br><span class="line">	r = make([]<span class="type">float32</span>, <span class="number">0</span>, len(bytes))</span><br><span class="line">	<span class="keyword">for</span> _, b := <span class="type">range</span> bytes &#123;</span><br><span class="line">		r = append(r, <span class="type">float32</span>(<span class="number">255</span>-b)/<span class="number">255</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意输入输出的签名是在模型导出的时候指定的</p>
<figure class="highlight tp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># mnist_softmax.py</span><br><span class="line">   .....</span><br><span class="line">    model_exporter.init(</span><br><span class="line">        sess.graph.as_graph_def(),</span><br><span class="line">        named_graph_signatures=&#123;</span><br><span class="line">            <span class="string">'inputs'</span>: exporter.generic_signature(&#123;<span class="string">'x'</span>: <span class="keyword">X</span>&#125;),  # 指明输入的参数名为x，类型维度和Tensor <span class="keyword">X</span> 一样</span><br><span class="line">            <span class="string">'outputs'</span>: exporter.generic_signature(&#123;<span class="string">'y'</span>: <span class="keyword">Y</span>&#125;)  # 指明输出的参数名为x，类型维度和Tensor <span class="keyword">Y</span> 一样</span><br><span class="line">        &#125;</span><br><span class="line">   )</span><br><span class="line">   ....</span><br></pre></td></tr></table></figure>
<p>运行main.go后可以在<a href="http://localhost:1323" target="_blank" rel="external">http://localhost:1323</a>访问web页面。</p>
<p>效果图:</p>
<p><img src="https://github.com/SineYuan/tensorflow-demo/blob/master/doc/images/mnist_web.png?raw=true" alt=""></p>
<h3 id="模型更新">模型更新</h3><p>有了前面的工作后，下面的就轻松了。现在我们来升级模型，直接上卷积神经网络。代码在<a href="https://github.com/SineYuan/tensorflow-demo/blob/master/mnist/mnist_cnn.py" target="_blank" rel="external">https://github.com/SineYuan/tensorflow-demo/blob/master/mnist/mnist_cnn.py</a></p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> mnist</span><br><span class="line"><span class="keyword">python</span> mnist_cnn.<span class="keyword">py</span> --model_version=<span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>卷积神经网络正确率在98%的左右。我们可以看到<code>model</code>目录下多了个<code>00000002</code>的文件夹，此时如何<code>tensorflow_model_server</code>还在运行的话会自动加载新的版本为2的模型，就是那么简单。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://sineyuan.github.io/2017/03/02/tensorflow-mnist-pratice/" data-id="cjbrnor8b00051g13za88e8k4" class="article-share-link">Share</a>
      
        <a href="http://sineyuan.github.io/2017/03/02/tensorflow-mnist-pratice/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/03/16/mxnet-begin/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          MXNet上手
        
      </div>
    </a>
  
  
    <a href="/2017/02/19/tensorflow-windows-installation/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">在Windows上安装Tensorflow</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>
</section>
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      <a href="/" class="logo">STep by STep</a>
      &copy; 2017 Sine Yuan<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    
<script>
  var disqus_shortname = 'sineyuansblog';
  
  var disqus_url = 'http://sineyuan.github.io/2017/03/02/tensorflow-mnist-pratice/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="/js/jquery.min.js" type="text/javascript"></script>
<script src="/js/jquery.scrollLoading.js" type="text/javascript"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
</body>
</html>